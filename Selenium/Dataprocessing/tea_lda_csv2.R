# install.packages("devtools", dependencies = TRUE)
# library(devtools)
# install_github("vqv/ggbiplot", force = TRUE)
library(ggbiplot)

datafile = "Tea_db_PCA_Ox.csv.csv" #Tea_db_PCA_doubled_rnd
getwd()
setwd("//home/stable/Dropbox/Students/2019/Demyanuk/Dataprocessing")
data <- read.table(datafile, header=TRUE, sep=";", dec=",")

data.species <- data[, 4]
#params <- log(data[, 5:15])
params <- data[, 5:15]

pairs(params)


# apply PCA - scale. = TRUE is highly 
# advisable, but default is FALSE. 
params.pca <- prcomp(params,
                 center = TRUE,
                 scale = TRUE) 
# print method
print(params.pca)
# plot method
plot(params.pca, type = "l")
# summary method
PC1<-params.pca$rotation[1]
PC2<-params.pca$rotation[2]

summary(params.pca)
# We can use the predict function if we observe new data and want to predict their PCs values. Just for illustration pretend the last two rows of the iris data has just arrived and we want to see what is their PCs values:
# Predict PCs
predict(params.pca, newdata=tail(params, 2))

# The Figure below is a biplot generated by the function ggbiplot of the ggbiplot package available on github.
# https://github.com/vqv/ggbiplot  data.species

g <- ggbiplot(params.pca, choices = 1:2, obs.scale = 1, 
              var.scale = 1, 
              varname.size = 4, 
              labels.size = 3, # points label by data value 
              labels = row.names(data[1:69,]),
              groups = data.species, 
              ellipse = TRUE, 
              circle = TRUE,
              circle.prob = 0.95)

#arrow_style <- arrow(length = unit(0.05, "inches"),
#                     type = "closed")

# http://www.sthda.com/english/wiki/ggplot2-scatter-plots-quick-start-guide-r-software-and-data-visualization
# g <- g  + geom_point(aes(colour = factor(data.species)), size = 2.5) +
#           geom_point(colour="black", size = .5)+ 
#           xlim(-6.,5.) + 
#           ylim(-4.5,5.)
  

g <- g + scale_color_manual(name="e-tongue", values=c("green","yellow","brown","blue","red"))

# https://www3.nd.edu/~steve/computing_with_data/12_Scales_themes/scales_themes.html
# http://docs.ggplot2.org/dev/vignettes/themes.html
g <- g + theme(axis.title.x = element_text(face="bold", colour="black", size=15),
              axis.text.x  = element_text(angle=0, vjust=0.5, size=16),
              axis.title.y = element_text(face="bold", colour="black", size=15),
              axis.text.y  = element_text(angle=0, vjust=0.5, size=16)) 


# http://sape.inf.usi.ch/quick-reference/ggplot2/themes
g <- g + theme(legend.direction = 'vertical', legend.position = 'right') +
  theme(legend.title = element_text(face = "italic", size = 15, angle = 0, color = "black") ) +
  theme(legend.text = element_text(colour="black", size=12, face="bold"))


print(g)
ggsave(filename = "datafile.png", plot = g, width = 6, height = 7)
