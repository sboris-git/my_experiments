#ready http://www.r-bloggers.com/computing-and-visualizing-pca-in-r/
rm(list=ls(all=TRUE))

library(devtools)
# install_github("ggbiplot", "vqv")
library(ggbiplot)
#library("factoextra")
#http://www.sthda.com/english/wiki/fviz-pca-quick-principal-component-analysis-data-visualization-r-software-and-data-mining

# /home/boris/Dropbox/Students/Стельмащук/Stelmashchuk@student/UJ my measurements/Analysis/CSV/PCA_II.csv
# /home/boris/Dropbox/Students/Стельмащук/Stelmashchuk@student/UJ my measurements/Analysis/CSV/PCA_III.csv
# /home/boris/Dropbox/Students/Стельмащук/Stelmashchuk@student/UJ my measurements/Analysis/CSV/PCA_II_VII.csv
# /home/boris/Dropbox/Students/Стельмащук/Stelmashchuk@student/UJ my measurements/Analysis/CSV/PCA_IV.csv
# /home/boris/Dropbox/Students/Стельмащук/Stelmashchuk@student/UJ my measurements/Analysis/CSV/PCA_I_VIII.csv
# /home/boris/Dropbox/Students/Стельмащук/Stelmashchuk@student/UJ my measurements/Analysis/CSV/PCA_I_VII_VIII.csv
# /home/boris/Dropbox/Students/Стельмащук/Stelmashchuk@student/UJ my measurements/Analysis/CSV/PCA_V.csv
# /home/boris/Dropbox/Students/Стельмащук/Stelmashchuk@student/UJ my measurements/Analysis/CSV/PCA_VI.csv
#path.name.ext <- "~/Dropbox/Students/Стельмащук/Stelmashchuk@student/UJ my measurements/Analysis/CSV/PCA_I_VII_VIII_n.csv"
#/home/student_n/Desktop/Analysis/CSV/PCA_V-excluded_NA.csv
# /home/student_n/Desktop/Analysis/CSV/PCA_VI-i.csv
path.name.ext <- "~/Desktop/Analysis/CSV/PCA_I-VIII.csv"
#path.name.ext <- "~/Dropbox/Students/Стельмащук/Stelmashchuk@student/UJ my measurements/Analysis/PCA_all_CV_I_VII.csv"
CV.dat <- read.delim(path.name.ext, header=TRUE, sep=";", dec=".")
#attach(CV.dat)
head(CV.dat)

# log transform 
log.ir <- CV.dat[, -1] # logtransform of numeric data log(CV.dat[, 2:30])
ir.species <- CV.dat[, 1] # extract and store names in variable
 
# apply PCA - scale. = TRUE is highly 
# advisable, but default is FALSE. 
ir.pca <- prcomp(log.ir, center = TRUE, scale = TRUE, na.action = na.exclude) #, na.action = na.exclude,

# print method
print(ir.pca)
PC1<-ir.pca$rotation[1]
PC2<-ir.pca$rotation[2]
# plot method
plot(ir.pca, type = "l")

# summary method
summary(ir.pca)

# Predict PCs
predict(ir.pca, newdata=tail(log.ir, 2))

# The Figure below is a biplot generated by the function ggbiplot of the ggbiplot package available on github.
# https://github.com/vqv/ggbiplot  ir.species
arrow_style <- arrow(length = unit(0.05, "inches"),
                     type = "closed")
# theme_bw()
g <- ggbiplot(ir.pca, choices = 3:4, obs.scale = 1, var.scale = 1, 
              groups = ir.species, ellipse = TRUE, circle = TRUE, circle.prob = 0.95, varname.size = 4)
# http://www.sthda.com/english/wiki/ggplot2-scatter-plots-quick-start-guide-r-software-and-data-visualization
g <- g  + geom_point(aes(colour = factor(ir.species)), size = 4.5) +
          geom_point(colour="black", size = 2)# + 
          ##geom_point(aes(shape = factor( CV.dat$dE_dt)), size = 3.5)
          #http://wilkelab.org/classes/SDS348/2015_spring_worksheets/class9_solutions.html
          #row.names((ir.pca$rotation)
          ##geom_text(aes(x=PC1, y=PC2, label=ir.species), hjust=0, size=4, color='black') + # label=row.names((ir.pca$rotation))
          ##geom_segment(aes(xend=PC1, yend=PC2), x=0, y=0, arrow=arrow_style)# +
          
g <- g + scale_color_discrete(name = '') + theme_bw()	#scale_color_hue(l = 80, c = 50)	    scale_color_grey()
# https://www3.nd.edu/~steve/computing_with_data/12_Scales_themes/scales_themes.html
# http://docs.ggplot2.org/dev/vignettes/themes.html
g <- g +theme(axis.title.x = element_text(face="bold", colour="black", size=15),
              axis.text.x  = element_text(angle=0, vjust=0.5, size=16),
              axis.title.y = element_text(face="bold", colour="black", size=15),
              axis.text.y  = element_text(angle=0, vjust=0.5, size=16)) 
# g <- g + theme(panel.background = element_rect(fill = "white"))
# doesn't work g <- g + theme(panel.border = element_rect(linetype = "dashed", colour = "black"))
# http://sape.inf.usi.ch/quick-reference/ggplot2/themes
g <- g + theme(legend.direction = 'horizontal', legend.position = 'bottom') +
         theme(legend.title = element_text(face = "italic", size = 15, angle = 0, color = "black") ) +
         theme(legend.text = element_text(colour="black", size=12, face="bold"))
         #guides(color = FALSE, size = FALSE) http://www.sthda.com/english/wiki/ggplot2-legend-easy-steps-to-change-the-position-and-the-appearance-of-a-graph-legend-in-r-software
         
#ggplot(rotation_data) + 
#  geom_segment(aes(xend=PC1, yend=PC2), x=0, y=0, arrow=arrow_style) + 
#  geom_text(aes(x=PC1, y=PC2, label=variable), hjust=0, size=3, color='red') + 
#  xlim(-1.,1.25) + 
#  ylim(-1.,1.) +
 # coord_fixed() # fix aspect ratio to 1:1        
         
print(g)
ggsave(filename = "PCA_I-VIII-PC3-4.png", plot = g, width = 6, height = 7)


